# Commodity Options Training Game - Project Rules

## Project Brief
Desktop-first, browser-only training game for EU-style Brent options (BUL) on ICE Brent futures (BRN). 
Static web (Next.js SSG) + Supabase (EU) for DB/Auth/Realtime + Edge Functions.
Education-only. Prices 15‑min delayed. EU data residency only.

## North Star Specification
- **Market**: ICE Brent (BRN) futures & EU‑Style Brent options (BUL), European exercise, contract size 1,000 bbl, $0.01/bbl tick
- **Model**: Black‑76 (options on futures). Greeks: Delta, Gamma, Vega, Theta (FD stable), Vanna, Vomma (read-only)
- **Live mode**: 15‑min delayed prices. Replay mode: historical day with price path + IV surface snapshots
- **Orders**: Market, Limit. Fills: mid-based with configurable bid/ask spread; no slippage; apply fees
- **Risk**: caps on |Δ|, |Γ|, |Vega|, |Θ| + 95% 1‑day VaR. Policy = allow but flag + penalize
- **Scoring**: Score = Realized PnL − (breach time α + VaR exceed β + drawdown γ + fees)
- **Sessions**: up to 25 players; solo; 60–90 min & multi‑day; instructor console

## Coding Standards
- TypeScript strict mode required
- Unit tests for all quant/risk calculations
- Finite‑difference convergence checks
- Put‑call parity validation under Black‑76
- Small, reviewable diffs with explanatory commit messages
- Conventional Commits format

## Terminal Commands Allow-list
- git init/add/commit/push/status/log
- npm ci/install/run/test
- npx supabase (link/db/functions/secrets)
- No other commands without explicit permission

## Acceptance Criteria
1. Public GitHub Pages URL loads the app
2. English-only interface, EU Supabase project
3. Create/join sessions with multi-tab support
4. Trade MKT/LMT orders with proper fills and fees
5. Live positions/Greeks/VAR/Score updates
6. Breaches flagged with penalties
7. Leaderboard real-time updates
8. Replay mode with speed control
9. Instructor shock capabilities
10. CSV exports functional
11. Compliance banners visible
12. All tests passing